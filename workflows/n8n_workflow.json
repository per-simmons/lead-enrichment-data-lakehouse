{
  "name": "AI Data Lakehouse Lead Pipeline",
  "nodes": [
    {
      "id": "schedule_trigger",
      "name": "Daily 9AM Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [250, 300],
      "parameters": {
        "rule": {
          "cronExpression": "0 9 * * *"
        }
      }
    },
    {
      "id": "phantombuster_launch",
      "name": "Launch LinkedIn Scraper",
      "type": "n8n-nodes-base.phantombuster",
      "typeVersion": 1,
      "position": [450, 300],
      "parameters": {
        "resource": "agent",
        "operation": "launch",
        "agentId": "={{$vars.PHANTOMBUSTER_AGENT_ID}}",
        "arguments": {
          "searchUrl": "https://www.linkedin.com/sales/search/people?query=(filters:List[(type:COMPANY_FOLLOWERS,values:List[(id:1441,selectionType:INCLUDED)])])",
          "numberOfResultsPerSearch": 100
        }
      },
      "credentials": {
        "phantombusterApi": {
          "id": "1",
          "name": "PhantomBuster API"
        }
      }
    },
    {
      "id": "wait_5min",
      "name": "Wait for Scraping",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [650, 300],
      "parameters": {
        "amount": 5,
        "unit": "minutes"
      }
    },
    {
      "id": "phantombuster_output",
      "name": "Get Scraper Results",
      "type": "n8n-nodes-base.phantombuster",
      "typeVersion": 1,
      "position": [850, 300],
      "parameters": {
        "resource": "agent",
        "operation": "getOutput",
        "agentId": "={{$vars.PHANTOMBUSTER_AGENT_ID}}"
      },
      "credentials": {
        "phantombusterApi": {
          "id": "1",
          "name": "PhantomBuster API"
        }
      }
    },
    {
      "id": "send_to_clay",
      "name": "Send to Clay Enrichment",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [1050, 300],
      "parameters": {
        "method": "POST",
        "url": "={{$vars.CLAY_WEBHOOK_URL}}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "leads",
              "value": "={{$json}}"
            }
          ]
        }
      }
    },
    {
      "id": "webhook_clay_enriched",
      "name": "Receive Enriched Data",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 500],
      "webhookId": "clay-enriched",
      "parameters": {
        "path": "clay-enriched",
        "responseMode": "onReceived",
        "responseData": "allEntries"
      }
    },
    {
      "id": "openai_grader",
      "name": "Grade Lead with AI",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [450, 500],
      "parameters": {
        "resource": "chat",
        "operation": "complete",
        "modelId": "gpt-4",
        "prompt": {
          "messages": [
            {
              "role": "system",
              "content": "You are a lead scoring expert for an AI-native data lakehouse company. Score leads based on:\n- Title/Seniority (Director+ = 30pts, Manager = 20pts, IC = 10pts)\n- Company Size (>500 employees = 20pts, 100-500 = 15pts, <100 = 5pts)\n- Tech Stack Match (Uses competitor = 30pts, Cloud-native = 20pts, Legacy = 5pts)\n- Revenue (>$50M = 20pts, $10-50M = 15pts, <$10M = 5pts)\n\nReturn JSON: {\"score\": 0-100, \"grade\": \"Gold/Silver/Bronze\", \"reasoning\": \"brief explanation\"}"
            },
            {
              "role": "user",
              "content": "Score this lead:\nName: {{$json.firstName}} {{$json.lastName}}\nTitle: {{$json.title}}\nCompany: {{$json.companyName}}\nEmployees: {{$json.employeeCount}}\nRevenue: {{$json.revenue}}\nTech Stack: {{$json.techStack}}"
            }
          ]
        },
        "maxTokens": 200,
        "temperature": 0.3
      },
      "credentials": {
        "openAiApi": {
          "id": "2",
          "name": "OpenAI API"
        }
      }
    },
    {
      "id": "parse_ai_score",
      "name": "Parse AI Score",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [650, 500],
      "parameters": {
        "language": "javascript",
        "code": "const aiResponse = $input.first().json.choices[0].message.content;\nconst scoreData = JSON.parse(aiResponse);\n\nreturn {\n  ...items[0].json,\n  aiScore: scoreData.score,\n  leadGrade: scoreData.grade,\n  gradeReasoning: scoreData.reasoning\n};"
      }
    },
    {
      "id": "route_by_grade",
      "name": "Route by Lead Grade",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [850, 500],
      "parameters": {
        "dataType": "string",
        "value1": "={{$json.leadGrade}}",
        "rules": {
          "rules": [
            {
              "value2": "Gold",
              "output": 0
            },
            {
              "value2": "Silver",
              "output": 1
            },
            {
              "value2": "Bronze",
              "output": 2
            }
          ]
        }
      }
    },
    {
      "id": "instantly_gold_campaign",
      "name": "Create Gold Campaign",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [1050, 400],
      "parameters": {
        "method": "POST",
        "url": "https://api.instantly.ai/v2/campaigns",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-API-KEY",
              "value": "={{$vars.INSTANTLY_API_KEY}}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "name",
              "value": "Gold Lead - {{$json.companyName}}"
            },
            {
              "name": "subject",
              "value": "Quick question about {{$json.companyName}}'s data infrastructure"
            },
            {
              "name": "body",
              "value": "Hi {{$json.firstName}},\n\nI noticed {{$json.companyName}} is using {{$json.competitorProduct}} for your data lakehouse needs.\n\nWe've helped similar companies reduce query times by 10x while cutting costs by 60%.\n\nWorth a quick chat to explore if we could help {{$json.companyName}} achieve similar results?\n\nBest,\n[Your Name]"
            },
            {
              "name": "email_list",
              "value": ["{{$json.email}}"]
            }
          ]
        }
      }
    },
    {
      "id": "instantly_silver_campaign",
      "name": "Create Silver Campaign",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [1050, 500],
      "parameters": {
        "method": "POST",
        "url": "https://api.instantly.ai/v2/campaigns",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-API-KEY",
              "value": "={{$vars.INSTANTLY_API_KEY}}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "name",
              "value": "Silver Lead - {{$json.companyName}}"
            },
            {
              "name": "subject",
              "value": "How {{$json.companyName}} can modernize data infrastructure"
            },
            {
              "name": "body",
              "value": "Hi {{$json.firstName}},\n\nI've been following {{$json.companyName}}'s growth and noticed you might be exploring modern data solutions.\n\nWould you be interested in a quick resource that shows how companies your size are handling data at scale?\n\nNo sales pitch - just sharing what's working for others in {{$json.industry}}.\n\nBest,\n[Your Name]"
            },
            {
              "name": "email_list",
              "value": ["{{$json.email}}"]
            }
          ]
        }
      }
    },
    {
      "id": "hubspot_upsert",
      "name": "Update HubSpot CRM",
      "type": "n8n-nodes-base.hubspot",
      "typeVersion": 2,
      "position": [1250, 450],
      "parameters": {
        "resource": "contact",
        "operation": "upsert",
        "email": "={{$json.email}}",
        "additionalFields": {
          "firstName": "={{$json.firstName}}",
          "lastName": "={{$json.lastName}}",
          "company": "={{$json.companyName}}",
          "jobTitle": "={{$json.title}}",
          "leadGrade": "={{$json.leadGrade}}",
          "aiScore": "={{$json.aiScore}}",
          "techStack": "={{$json.techStack.join(', ')}}",
          "enrichmentDate": "={{new Date().toISOString()}}",
          "campaignStatus": "Enrolled"
        }
      },
      "credentials": {
        "hubspotOAuth2Api": {
          "id": "3",
          "name": "HubSpot OAuth2"
        }
      }
    },
    {
      "id": "webhook_instantly_events",
      "name": "Instantly Event Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 700],
      "webhookId": "instantly-events",
      "parameters": {
        "path": "instantly-events",
        "responseMode": "onReceived",
        "responseData": "allEntries"
      }
    },
    {
      "id": "process_instantly_event",
      "name": "Process Email Event",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [450, 700],
      "parameters": {
        "dataType": "string",
        "value1": "={{$json.event_type}}",
        "rules": {
          "rules": [
            {
              "value2": "reply",
              "output": 0
            },
            {
              "value2": "open",
              "output": 1
            },
            {
              "value2": "click",
              "output": 2
            },
            {
              "value2": "bounce",
              "output": 3
            }
          ]
        }
      }
    },
    {
      "id": "update_hubspot_replied",
      "name": "Update Status - Replied",
      "type": "n8n-nodes-base.hubspot",
      "typeVersion": 2,
      "position": [650, 650],
      "parameters": {
        "resource": "contact",
        "operation": "update",
        "email": "={{$json.email}}",
        "updateFields": {
          "campaignStatus": "Replied",
          "lastEngagementDate": "={{new Date().toISOString()}}"
        }
      },
      "credentials": {
        "hubspotOAuth2Api": {
          "id": "3",
          "name": "HubSpot OAuth2"
        }
      }
    },
    {
      "id": "create_hubspot_deal",
      "name": "Create Deal for Reply",
      "type": "n8n-nodes-base.hubspot",
      "typeVersion": 2,
      "position": [850, 650],
      "parameters": {
        "resource": "deal",
        "operation": "create",
        "stage": "appointmentscheduled",
        "additionalFields": {
          "dealName": "{{$json.companyName}} - Data Lakehouse Opportunity",
          "amount": "50000",
          "closeDate": "={{new Date(Date.now() + 30*24*60*60*1000).toISOString()}}",
          "associatedCompany": "{{$json.companyName}}",
          "associatedContacts": ["{{$json.email}}"]
        }
      },
      "credentials": {
        "hubspotOAuth2Api": {
          "id": "3",
          "name": "HubSpot OAuth2"
        }
      }
    },
    {
      "id": "slack_notification",
      "name": "Notify Sales Team",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 1,
      "position": [1050, 650],
      "parameters": {
        "resource": "message",
        "operation": "post",
        "channel": "#sales-signals",
        "text": "ðŸ”¥ *Hot Lead Replied!*\n\n*Name:* {{$json.firstName}} {{$json.lastName}}\n*Company:* {{$json.companyName}}\n*Title:* {{$json.title}}\n*Grade:* {{$json.leadGrade}} (Score: {{$json.aiScore}})\n*Email:* {{$json.email}}\n\n*Reply Preview:* {{$json.replyText.substring(0, 200)}}...\n\n<https://app.hubspot.com/contacts/search?query={{$json.email}}|View in HubSpot>"
      },
      "credentials": {
        "slackApi": {
          "id": "4",
          "name": "Slack API"
        }
      }
    }
  ],
  "connections": {
    "schedule_trigger": {
      "main": [
        [
          {
            "node": "phantombuster_launch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "phantombuster_launch": {
      "main": [
        [
          {
            "node": "wait_5min",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "wait_5min": {
      "main": [
        [
          {
            "node": "phantombuster_output",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "phantombuster_output": {
      "main": [
        [
          {
            "node": "send_to_clay",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "webhook_clay_enriched": {
      "main": [
        [
          {
            "node": "openai_grader",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "openai_grader": {
      "main": [
        [
          {
            "node": "parse_ai_score",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "parse_ai_score": {
      "main": [
        [
          {
            "node": "route_by_grade",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "route_by_grade": {
      "main": [
        [
          {
            "node": "instantly_gold_campaign",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "instantly_silver_campaign",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "hubspot_upsert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "instantly_gold_campaign": {
      "main": [
        [
          {
            "node": "hubspot_upsert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "instantly_silver_campaign": {
      "main": [
        [
          {
            "node": "hubspot_upsert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "webhook_instantly_events": {
      "main": [
        [
          {
            "node": "process_instantly_event",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "process_instantly_event": {
      "main": [
        [
          {
            "node": "update_hubspot_replied",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "update_hubspot_replied": {
      "main": [
        [
          {
            "node": "create_hubspot_deal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "create_hubspot_deal": {
      "main": [
        [
          {
            "node": "slack_notification",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": false
  },
  "pinData": {},
  "versionId": "1.0.0",
  "triggerCount": 0,
  "tags": []
}